<!DOCTYPE html>
<html lang="de-CH">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Statistik — AI Dashboard</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <header>
    <h1>Statistik</h1>
    <nav>
      <a href="index.html">Startseite</a>
      <a href="stats.html">Statistik</a>
    </nav>
  </header>

  <main>
    <section class="card">
      <h2>Abend-Check Analyse</h2>
      <form id="stats-form">
        <label>
          Zeitraum:
          <select id="range-select">
            <option value="7">Letzte 7 Tage</option>
            <option value="30">Letzte 30 Tage</option>
            <option value="60">Letzte 60 Tage</option>
            <option value="90">Letzte 90 Tage</option>
          </select>
        </label>
        <button type="submit">Anzeigen</button>
      </form>
      <div id="stats-result"></div>
    </section>

    <section class="card">
      <h2>Einträge</h2>
      <ul id="checks-list"></ul>
    </section>
  </main>

  <footer>
    <p>Statistiken basieren auf Einträgen im Browser-Speicher.</p>
  </footer>

  <script>
    // Helper
    const db = {
      get(key) { try { return JSON.parse(localStorage.getItem(key)) || []; } catch(e) { return []; } }
    };

    const rangeSelect = document.getElementById('range-select');
    const statsResult = document.getElementById('stats-result');
    const checksList = document.getElementById('checks-list');

    function computeStats(days) {
      const checks = db.get('dailyChecks');
      if (!checks.length) {
        return '<p>Noch keine Einträge vorhanden.</p>';
      }

      const cutoff = new Date();
      cutoff.setDate(cutoff.getDate() - days);

      const filtered = checks.filter(c => new Date(c.date) > cutoff);
      if (!filtered.length) {
        return `<p>Keine Einträge in den letzten ${days} Tagen.</p>`;
      }

      const avgMood = (filtered.reduce((s, c) => s + parseInt(c.mood, 10), 0) / filtered.length).toFixed(1);
      const avgEnergy = (filtered.reduce((s, c) => s + parseInt(c.energy, 10), 0) / filtered.length).toFixed(1);
      const avgStress = (filtered.reduce((s, c) => s + parseInt(c.stress, 10), 0) / filtered.length).toFixed(1);

      return `
        <div class="info">
          <strong>${filtered.length} Einträge</strong> in den letzten ${days} Tagen<br>
          <strong>Stimmung:</strong> ⌀ ${avgMood}/10<br>
          <strong>Energie:</strong> ⌀ ${avgEnergy}/10<br>
          <strong>Stress:</strong> ⌀ ${avgStress}/10
        </div>
      `;
    }

    function renderChecksList() {
      const checks = db.get('dailyChecks');
      checksList.innerHTML = '';
      checks.slice().reverse().forEach(c => {
        const li = document.createElement('li');
        li.innerHTML = `
          <div>
            <strong>${c.date}</strong><br>
            Stimmung: ${c.mood}, Energie: ${c.energy}, Stress: ${c.stress}<br>
            <small>${c.note || '(keine Notiz)'}</small>
          </div>
        `;
        checksList.appendChild(li);
      });
    }

    document.getElementById('stats-form').addEventListener('submit', (e) => {
      e.preventDefault();
      const days = parseInt(rangeSelect.value, 10);
      statsResult.innerHTML = computeStats(days);
    });

    // Initial load
    renderChecksList();
    statsResult.innerHTML = computeStats(7);
  </script>
</body>
</html>
